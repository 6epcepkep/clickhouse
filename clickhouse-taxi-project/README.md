# NYC Taxi Trips ‚Äî ClickHouse Analytics Project

–ü—Ä–æ–µ–∫—Ç –ø–æ –∞–Ω–∞–ª–∏–∑—É –ø–æ–µ–∑–¥–æ–∫ —Ç–∞–∫—Å–∏ –≤ –ù—å—é-–ô–æ—Ä–∫–µ (–¥–∞–Ω–Ω—ã–µ –∑–∞ 2016 –≥–æ–¥) —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º ClickHouse, –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π –∏ Superset.


## üìö –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞](#—Å—Ç—Ä—É–∫—Ç—É—Ä–∞-–ø—Ä–æ–µ–∫—Ç–∞)
- [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫](#—É—Å—Ç–∞–Ω–æ–≤–∫–∞-–∏-–∑–∞–ø—É—Å–∫)
  - [–£—Å—Ç–∞–Ω–æ–≤–∫–∞ ClickHouse](#1-—É—Å—Ç–∞–Ω–æ–≤–∫–∞-clickhouse)
  - [–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è Python](#2-–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞-–æ–∫—Ä—É–∂–µ–Ω–∏—è-python)
  - [–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Superset](#3-–ø–µ—Ä–≤–∏—á–Ω–∞—è-–∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è-superset)
  - [–ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü](#4-–Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ-—Ç–∞–±–ª–∏—Ü—ã-routes)
  - [–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ drivers](#5-–≥–µ–Ω–µ—Ä–∞—Ü–∏—è-–∏-–Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ-—Ç–∞–±–ª–∏—Ü—ã-drivers)
  - [–ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö](#6-–Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–∏–µ-—Ç–∞–±–ª–∏—Ü—ã-trips_raw-–∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏-–¥–∞–Ω–Ω—ã–º–∏)
  - [–ó–∞–ø—É—Å–∫ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞](#7-–∑–∞–ø—É—Å–∫-—Å—Ç—Ä–∏–º–∏–Ω–≥–∞-—ç–º—É–ª—è—Ü–∏—è)
  - [–°–∫—Ä—ã—Ç–∏–µ –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π](#8-–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ-–≤-–¥–∞—à–±–æ—Ä–¥–µ)
- [–í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è](#–≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è)
- [–û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏](#–æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏)
- [–ü—Ä–∏–º–µ—Ä –¥–∞—à–±–æ—Ä–¥–æ–≤](#–ø—Ä–∏–º–µ—Ä-–¥–∞—à–±–æ—Ä–¥–æ–≤)
- [–ê–≤—Ç–æ—Ä](#–∞–≤—Ç–æ—Ä)

---
---

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

‚îú‚îÄ‚îÄ clickhouse-superset
‚îÇ   ‚îú‚îÄ‚îÄ load_data
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ convert_parquet_to_csv.py				 	# –°–∫—Ä–∏–ø—Ç –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É—é—â–∏–π —Ñ–∞–π–ª —Å –≤—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏ .parquet -> .csv
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generate_drivers.py								# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã –≤–æ–¥–∏—Ç–µ–ª–µ–π (drivers)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ generate_routes.py								# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è —Ç–∞–±–ª–∏—Ü—ã –º–∞—Ä—à—Ä—É—Ç–æ–≤ (routes)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ load_trips.py											# –ó–∞–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö –ø–æ–µ–∑–¥–æ–∫ –≤ ClickHouse
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ stream_trips.py										# –ò–º–∏—Ç–∞—Ü–∏—è —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ –¥–∞–Ω–Ω—ã—Ö –≤ ClickHouse (–ø–æ 100 –∑–∞–ø–∏—Å–µ–π/—Å–µ–∫)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ yellow_tripdata_2016-01.parquet		# –§–∞–π–ª —Å –≤—Ö–æ–¥–Ω—ã–º–∏ –¥–∞–Ω–Ω—ã–º–∏
‚îÇ   ‚îú‚îÄ‚îÄ superset_config
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ superset_config.py								# –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Superset
‚îÇ   ‚îú‚îÄ‚îÄ init_clickhouse_taxi_project.sql 			# SQL-—Å–∫—Ä–∏–ø—Ç: —Å–æ–∑–¥–∞–Ω–∏–µ —Ç–∞–±–ª–∏—Ü, –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–π, MV –≤ ClickHouse
‚îÇ   ‚îî‚îÄ‚îÄ requirements.txt											# –°–ø–∏—Å–æ–∫ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π Python
‚îú‚îÄ‚îÄ config_dashboard
‚îÇ   ‚îú‚îÄ‚îÄ dashboard_export_heavy.zip						# –ö–æ—Ñ–Ω–∏–≥—É—Ä–∞—Ü–∏—è "—Ç—è–∂–µ–ª–æ–≥–æ" –¥–∞—à–±–æ—Ä–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ dashboard_export_live.zip							# –ö–æ—Ñ–Ω–∏–≥—É—Ä–∞—Ü–∏—è "–∂–∏–≤–æ–≥–æ" –¥–∞—à–±–æ—Ä–¥–∞
‚îú‚îÄ‚îÄ dbdiagram.io_shema
‚îÇ   ‚îú‚îÄ‚îÄ shema_db.dbml													# –ú–æ–¥–µ–ª—å —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ë–î –≤ —Ñ–æ—Ä–º–∞—Ç–µ DBML
‚îÇ   ‚îú‚îÄ‚îÄ shema_db.pdf													# –°—Ö–µ–º–∞ –ë–î –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ .pdf
‚îÇ   ‚îî‚îÄ‚îÄ shema_db.svg													# –°—Ö–µ–º–∞ –ë–î –ø—Ä–æ–µ–∫—Ç–∞ –≤ —Ñ–æ—Ä–º–∞—Ç–µ .svg
‚îú‚îÄ‚îÄ img
‚îÇ   ‚îú‚îÄ‚îÄ heavy_dashboard.png										# –°–∫—Ä–∏–Ω—à–æ—Ç "—Ç—è–∂–µ–ª–æ–≥–æ" –¥–∞—à–±–æ—Ä–¥–∞
‚îÇ   ‚îú‚îÄ‚îÄ streaming_data.gif										# –ê–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–Ω—à–æ—Ç –ø–æ—Ç–æ–∫–∞ –¥–∞–Ω–Ω—ã—Ö
‚îÇ   ‚îú‚îÄ‚îÄ live_dashboard.png										# –°–∫—Ä–∏–Ω—à–æ—Ç "–∂–∏–≤–æ–≥–æ" –¥–∞—à–±–æ—Ä–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ streaming_update_dashboard.gif				# –ê–Ω–∏–º–∞—Ü–∏–æ–Ω–Ω—ã–π —Å–∫—Ä–∏–Ω—à–æ—Ç "–∂–∏–≤–æ–≥–æ" –¥–∞—à–±–æ—Ä–¥–∞
‚îú‚îÄ‚îÄ services
‚îÇ   ‚îú‚îÄ‚îÄ clickhouse-server.service							# –ö–æ–Ω—Ñ–∏–≥–∞—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ clickhouse-server –≤ Ubuntu
‚îÇ   ‚îî‚îÄ‚îÄ superset.service											# –ö–æ–Ω—Ñ–∏–≥–∞—Ä–∞—Ü–∏—è —Å–µ—Ä–≤–∏—Å–∞ superset –≤ Ubuntu
‚îú‚îÄ‚îÄverifycation_data
‚îÇ		‚îî‚îÄ‚îÄ check_clickhouse_objects.sql					# SQL-—Å–∫—Ä–∏–ø—Ç: –º–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ –ë–î
‚îî‚îÄ‚îÄ README.md                                 # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –∏–ª–∏ README


---

## ‚öôÔ∏è –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∏ –∑–∞–ø—É—Å–∫


### 1. –£—Å—Ç–∞–Ω–æ–≤–∫–∞ ClickHouse

–°–ª–µ–¥—É–π—Ç–µ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–π –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏: https://clickhouse.com/docs/en/getting-started/install
```bash
	curl https://clickhouse.com/ | sh
	sudo ./clickhouse install
```

=====================================================================================================================
P.S. –î–ª—è –∑–∞–≥—Ä—É–∑–∫–∏ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö —É–≤–µ–ª–∏—á–∏–ª –ø–∞–º—è—Ç—å –¥–æ 8–≥–± –≤ config.xml:
```xml
	<max_memory_usage>8000000000</max_memory_usage>
```

*–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Å–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å, —Å–º. —Ñ–∞–π–ª clickhouse-server.service):
–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥—Ä–∞–∫—Ç–Ω–æ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞:
```bash
	sudo systemctl daemon-reexec # –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç –≤—Å–µ —Ñ–∞–π–ª—ã —é–Ω–∏—Ç–æ–≤, –∞ –Ω–µ –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é systemd
	sudo systemctl daemon-reload # –ø—Ä–µ–¥–ø–∏—Å—ã–≤–∞–µ—Ç systemd –ø–µ—Ä–µ–∑–∞–≥—Ä—É–∑–∏—Ç—å –∏ –æ–±–Ω–æ–≤–∏—Ç—å —Å–≤–æ—é –≤–Ω—É—Ç—Ä–µ–Ω–Ω—é—é –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é
```
–ò –∫–æ–º–∞–Ω–¥—ã –≤–∫–ª—é—á–µ–Ω–∏—è, –∑–∞–ø—É—Å–∫–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:
```bash
	sudo systemctl enable clickhouse-server
	sudo systemctl start clickhouse-server
	sudo systemctl restart clickhouse-server
	sudo systemctl stop clickhouse-server
```


### 2. –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –æ–∫—Ä—É–∂–µ–Ω–∏—è Python

```bash
	sudo apt update
	sudo apt install -y build-essential libssl-dev libffi-dev python3-dev python3-pip python3-venv libpq-dev libsasl2-dev

	python3 -m venv venv
	source venv/bin/activate
	pip install -r requirements.txt
```

P.S. –í–æ–∑–º–æ–∂–Ω–æ –∫–æ–º—É-—Ç–æ –º–æ–∏ —à–∞–≥–∏, –º–æ–≥—É—Ç –±—ã—Ç—å –ø–æ–ª–µ–∑–Ω—ã:
	
–î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ (–∏–Ω–æ–≥–¥–∞ –±—ã–ª–∏ –Ω–µ –¥–æ—Å—Ç—É–ø–Ω—ã –ø—Ä–µ–¥—ã–¥—É—â–∏–µ –≤–µ—Ä—Å–∏–∏ –ø–∞–∫–µ—Ç–æ–≤):
```bash
	sudo nano /etc/resolv.conf
	nameserver 8.8.8.8
	nameserver 1.1.1.1
```

–î–ª—è —É—Å—Ç–∞–Ω–æ–≤–∫–∏ superset —Ç—Ä–µ–±—É–µ—Ç—Å—è Pyton –∏ –≤—ã—è—Å–Ω–∏–ª–æ—Å—å, —á—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Python 3.10 (–∏–ª–∏ 3.9 –∏–∑ –∏—Å—Ö–æ–¥–Ω–∏–∫–æ–≤):
```bash
	sudo apt update
	sudo apt install -y wget build-essential libssl-dev zlib1g-dev \
			libncurses5-dev libncursesw5-dev libreadline-dev libsqlite3-dev \
			libgdbm-dev libdb5.3-dev libbz2-dev libexpat1-dev liblzma-dev tk-dev

	cd /usr/src
	sudo wget https://www.python.org/ftp/python/3.10.14/Python-3.10.14.tgz
	sudo tar xvf Python-3.10.14.tgz
	cd Python-3.10.14
	sudo ./configure --enable-optimizations
	sudo make -j$(nproc)
	sudo make altinstall
```

–°–æ–∑–¥–∞—ë–º –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–µ –æ–∫—Ä—É–∂–µ–Ω–∏–µ –≤ –¥–æ–º–∞—à–Ω–µ–º –∫–∞—Ç–∞–ª–æ–≥–µ (—á—Ç–æ–±—ã –∏–∑–±–µ–∂–∞—Ç—å –æ—à–∏–±–æ–∫ —Å –ø—Ä–∞–≤–∞–º–∏ –¥–æ—Å—Ç—É–ø–∞):
```bash
	cd ~
	python3.10 -m venv superset-venv
	source superset-venv/bin/activate
```
–£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π:
```bash
	pip install --upgrade pip setuptools wheel
	pip install apache-superset
```


### 3. –ü–µ—Ä–≤–∏—á–Ω–∞—è –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Superset:
–°–æ–∑–¥–∞—ë–º superset_config.py:
```bash
	nano ~/superset_config.py
```
–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É–µ–º –¥–ª—è –Ω–µ–≥–æ –∫–ª—é—á SECRET_KEY = "xXXXx", –∫–æ–º–∞–Ω–¥–æ–π:
```bash		
	openssl rand -base64 42
```		
—É–∫–∞–∑—ã–≤–∞–µ–º Superset, –≥–¥–µ –∏—Å–∫–∞—Ç—å –∫–æ–Ω—Ñ–∏–≥, –¥–ª—è —ç—Ç–æ–≥–æ —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º –ø–µ—Ä–µ–º–µ–Ω–Ω—É—é –æ–∫—Ä—É–∂–µ–Ω–∏—è SUPERSET_CONFIG_PATH:
```bash		
	export SUPERSET_CONFIG_PATH=~/clickhouse-superset/superset_config.py
```

–î–∞–ª–µ–µ –≤–æ–∑–º–æ–∂–Ω–æ –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–Ω—É—é –≤–µ—Ä—Å–∏—é marshmallow (–±–∏–±–ª–∏–æ—Ç–µ–∫–∞ –¥–ª—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏–∏ —Å—Ö–µ–º):
```bash		
	pip install marshmallow==3.19.0
```

–ó–∞–ø—É—Å–∫–∞–µ–º –≤ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–º –æ–∫—Ä—É–∂–µ–Ω–∏–∏:
```bash		
	superset fab create-admin \
		--username admin \
		--firstname Admin \
		--lastname User \
		--email admin@example.com \
		--password admin
```

–û–±–Ω–æ–≤–ª—è–µ–º –ë–î:
```bash		
	superset db upgrade
````		

–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä—É–µ–º –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ:
```bash		
	superset init
```

–î–ª—è –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è –∫ –ë–î –º–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è sqlalchemy-clickhouse:
```bash	
	pip install clickhouse-sqlalchemy
```

```bash	
	python3 -m venv venv 					# –°–æ–∑–¥–∞–Ω–∏–µ –≤–∏—Ä—Ç—É–∞–ª—å–Ω–æ–≥–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è
	source venv/bin/activate			# –ê–∫—Ç–∏–≤–∞—Ü–∏—è
	pip install requests 					# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π 
	pip install clickhouse-driver # –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –¥—Ä–∞–π–≤–µ—Ä–∞ 
```

*–û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ (–¥–ª—è —É–¥–æ–±—Å—Ç–≤–∞ —Å–æ–∑–¥–∞–µ–º —Å–µ—Ä–≤–∏—Å, —Å–º. —Ñ–∞–π–ª superset.service):
–ö–æ–º–∞–Ω–¥—ã –¥–ª—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –æ–¥–Ω–æ–≥—Ä–∞–∫—Ç–Ω–æ –ø–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Å–µ—Ä–≤–∏—Å–∞:
```bash	
	sudo systemctl daemon-reexec
	sudo systemctl daemon-reload
```	
	–ò –∫–æ–º–∞–Ω–¥—ã –≤–∫–ª—é—á–µ–Ω–∏—è, –∑–∞–ø—É—Å–∫–∞, –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫–∞ –∏ –æ—Å—Ç–∞–Ω–æ–≤–∫–∏:
```bash	
	sudo systemctl enable superset
	sudo systemctl start superset
	sudo systemctl restart superset
	sudo systemctl stop superset
```

	–°–æ–¥–µ—Ä–∂–∏–º–æ–µ `requirements.txt`:

```bash
	certifi==2025.4.26
	charset-normalizer==3.4.2
	idna==3.10
	requests==2.32.3
	urllib3==2.4.0
	clickhouse-driver>=0.2.6
	lz4
	clickhouse-cityhash
	pandas
	pyarrow
```

---

–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ Superset –¥–æ—Å—Ç—É–ø–µ–Ω –ø–æ –∞–¥—Ä–µ—Å—É:
```bash
	URL: http://localhost:8088/login/
	–õ–æ–≥–∏–Ω: admin
	–ü–∞—Ä–æ–ª—å: admin
```

### 4. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã routes:
–°—Ç–∞—Ä—ã–π –≤–∏–¥ –¥–∞–Ω–Ω—ã—Ö –Ω–µ –ø–æ–ª—É—á–∏–ª–æ—Å—å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å, –ø–æ—ç—Ç–æ–º—É —Å–∫–∞—á–∏–≤–∞–µ–º —Ñ–∞–π–ª –ë–î —Ç–∞–∫—Å–∏ (yellow_tripdata_2015-01.csv(1.99 GB)):
https://www.kaggle.com/datasets/elemento/nyc-yellow-taxi-trip-data?resource=download
	
–£ —Ñ–∞–π–ª–∞ –Ω–æ–≤—ã–π –∫–æ–ª–æ–Ω–æ—á–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ö—Ä–∞–Ω–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö - parquet - –æ–ø—Ç–∏–º–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∏ —á—Ç–µ–Ω–∏—è –±–æ–ª—å—à–∏—Ö –æ–±—ä–µ–º–æ–≤ —Ç–∞–±–ª–∏—Ü. –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –±–æ–ª—å—à–∏—Ö –¥–∞–Ω–Ω—ã—Ö (Big Data), Apache Spark, Hadoop, ClickHouse, Pandas –∏ –¥—Ä.
	
–î–ª—è –ø–æ–¥–¥–µ—Ä–∂–∫–∏ –∏ —Ä–∞–±–æ—Ç—ã —Å —ç—Ç–∏–º —Ñ–æ—Ä–º–∞—Ç–æ–º –Ω—É–∂–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –µ—â—ë –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—å:
```bash
	pip install pandas pyarrow
```

–°–∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å –µ–≥–æ –≤ csv —Å–∫—Ä–∏–ø—Ç–æ–º convert_parquet_to_csv.py:
```bash
	import pandas as pd
	df = pd.read_parquet("yellow_tripdata_2016-01.parquet") # –ó–∞–≥—Ä—É–∑–∫–∞ Parquet-—Ñ–∞–π–ª–∞
	df.to_csv("yellow_tripdata_2016-01.csv", index=False)   # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ CSV
	print("‚úÖ –ö–æ–Ω–≤–µ—Ä—Ç–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞.")
```
–í —Ä–µ–∑—É–ª—å—Ç–∞—Ç–µ –ø–æ—è–≤–∏—Ç—Å—è —Å–∫–æ–Ω–≤–µ—Ä–∏—Ç–æ—Ä–æ–≤–∞–Ω–Ω—ã–π —Ñ–∞–π–ª yellow_tripdata_2016-01.csv –≤ –∫–∞—Ç–∞–ª–æ–≥–µ ~/clickhouse-superset/load_data.
–ó–∞–ø—É—Å–∫–∞–µ–º —Å–∫—Ä–∏–ø—Ç generate_routes.py 
	
### 5. –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∏ –Ω–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ç–∞–±–ª–∏—Ü—ã drivers:
```bash
	python3 generate_drivers.py
````

### 6. –ù–∞–ø–æ–ª–Ω–µ–Ω–∏–∏–µ —Ç–∞–±–ª–∏—Ü—ã trips_raw –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏–º–∏ –¥–∞–Ω–Ω—ã–º–∏:
```bash
	python3 load_trips.py
```

### 7. –ó–∞–ø—É—Å–∫ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ (—ç–º—É–ª—è—Ü–∏—è). –ü–µ—Ä–µ–¥ –∑–∞–ø—É—Å–∫–æ–º yellow_tripdata_2016-01.csv –Ω–∞ –º–µ—Å—Ç–µ:
```bash
	python3 stream_trips.py
```

### 8. –û–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ: 
–í –¥–∞—à–±–æ—Ä–¥–µ –º–æ–∂–Ω–æ –¥–æ–±–∞–≤–∏—Ç—å css-–ø—Ä–∞–≤–∏–ª–æ –¥–ª—è —Å–∫—Ä—ã—Ç–∏—è –≤—Å–ø–ª—ã–≤–∞—é—â–∏—Ö –ø–æ–¥—Å–∫–∞–∑–∫–∞—Ö –æ–± –∞–≤—Ç–æ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏:

–û—Ç–∫—Ä—ã—Ç—å –¥–∞—à–±–æ—Ä–¥ ‚Üí Edit dashboard ‚Üí Edit CSS ‚Üí LOAD A CSS TEMPLATE:
```css
	div[role="alert"] {
		display: none !important;
		visibility: hidden !important;
		height: 0 !important;
		margin: 0 !important;
		padding: 0 !important;
		overflow: hidden !important;
		pointer-events: none !important;
	}
```

### 9. –ú–∏–Ω–∏–º–∞–ª—å–Ω–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –Ω–∞–ø–æ–ª–Ω–µ–Ω–Ω–æ—Å—Ç–∏ –ë–î:
```bash
	clickhouse-client < ~/clickhouse-superset/verifycation_data/check_clickhouse_objects.sql
```

---

## üìä –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è

–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è **Superset 2.1+**. –í—Å–µ –≥—Ä–∞—Ñ–∏–∫–∏ –æ—Å–Ω–æ–≤–∞–Ω—ã –Ω–∞ –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã—Ö –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è—Ö.

"–¢—è–∂–µ–ª–∞—è" –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç–∞–∫—Å–∏ –≤ Clickhouse (–æ—Å–Ω–æ–≤–∞–Ω–∞ –Ω–∞ –∏—Å—Ç–æ—Ä–∏—á–µ—Å–∫–∏—Ö –¥–∞–Ω–Ω—ã—Ö):
	- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–µ–∑–¥–æ–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏
	- –ü—Ä–æ—Ü–µ–Ω—Ç–Ω–æ–µ –∏–∑–º–µ–Ω–µ–Ω–∏–µ –ø–æ–µ–∑–¥–æ–∫ –ø–æ —á–∞—Å–∞–º –∑–∞ –¥–µ–Ω—å
	- –¢–æ–ø-10 –ø—Ä–∏–±—ã–ª—å–Ω—ã—Ö –º–∞—Ä—à—Ä—É—Ç–æ–≤
	- –¢–æ–ø-10 –≤–æ–¥–∏—Ç–µ–ª–µ–π –ø–æ –≤—ã—Ä—É—á–∫–µ
	- –°—Ä–µ–¥–Ω—è—è —Å—Ç–æ–∏–º–æ—Å—Ç—å –ø–æ–µ–∑–¥–æ–∫ –ø–æ –º–∞—Ä—à—Ä—É—Ç–∞–º
	- –¢–æ–ø-10 –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø–æ –∫–æ–ª–∏—á–µ—Å—Ç–≤—É –ø–æ–µ–∑–¥–æ–∫ –∑–∞ –Ω–µ–¥–µ–ª—é
	- –î–æ–ª—è –≤—ã—Ä—É—á–∫–∏ –ø–æ —Ç–∏–ø–∞–º –æ–ø–ª–∞—Ç—ã
	- –í—ã—Ä—É—á–∫–∞ –ø–æ –∫–æ–º–ø–∞–Ω–∏—è–º-–ø–æ—Å—Ç–∞–≤—â–∏–∫–∞–º –º–∞—à–∏–Ω
	- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–µ–∑–¥–æ–∫ –ø–æ –≤—Ä–µ–º–µ–Ω–∏

"–ñ–∏–≤–∞—è" –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç–∞–∫—Å–∏ –≤ Clickhouse (–∑–∞ –ø–æ—Å–ª–µ–¥–Ω–∏–µ 15 –º–∏–Ω—É—Ç):
	- –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –ø–æ–µ–∑–¥–æ–∫ –ø–æ —Å–ø–æ—Å–æ–±—É –æ–ø–ª–∞—Ç—ã
	- –í—ã—Ä—É—á–∫–∞ –ø–æ —Ç–∞–∫—Å–æ–ø–∞—Ä–∫–∞–º
	- –¢–æ–ø-10 –º–∞—Ä—à—Ä—É—Ç–æ–≤ –ø–æ —Å—Ä–µ–¥–Ω–µ–º—É —á–µ–∫—É
	- –¢–æ–ø-10 –≤–æ–¥–∏—Ç–µ–ª–µ–π –ø–æ —á–∏—Å–ª—É –ø–æ–µ–∑–¥–æ–∫
	- –†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ø–æ–µ–∑–¥–æ–∫

---

## üìå –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

- –ò—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –∞–≥—Ä–µ–≥–∏—Ä—É—é—â–∏–µ –∏ TTL MV
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ —Å—Ç—Ä–∏–º–∏–Ω–≥–∞ (–¥–∞–Ω–Ω—ã–µ –ø–æ—Å—Ç—É–ø–∞—é—Ç –≤ —Ç–∞–±–ª–∏—Ü—É –ø–æ 100 —Å—Ç—Ä–æ–∫ –≤ —Å–µ–∫—É–Ω–¥—É)
- –í—Å–µ —Å–≤—è–∑–∏ –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã –≤ DBML

---


---

## üîÑ –û–±—Ä–∞–±–æ—Ç–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (Data Pipeline)

–í –ø—Ä–æ–µ–∫—Ç–µ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω –ø–æ–ª–Ω–æ—Ü–µ–Ω–Ω—ã–π **–ø–æ—Ç–æ–∫ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –¥–∞–Ω–Ω—ã—Ö (–ø–∞–π–ø–ª–∞–π–Ω)**, –≤–∫–ª—é—á–∞—é—â–∏–π:

1. **–ò—Å—Ç–æ—á–Ω–∏–∫ –¥–∞–Ω–Ω—ã—Ö** ‚Äî `stream_trips.py` –ø–æ–¥–∞—ë—Ç –ø–æ–µ–∑–¥–∫–∏ —Å –∑–∞–¥–µ—Ä–∂–∫–æ–π (—ç–º—É–ª—è—Ü–∏—è real-time).
2. **–•—Ä–∞–Ω–∏–ª–∏—â–µ —Å–æ–±—ã—Ç–∏–π** ‚Äî `trips_raw` –≤ ClickHouse.
3. **–ê–≥—Ä–µ–≥–∞—Ü–∏—è –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏** ‚Äî –º–∞—Ç–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è —Å `TTL 15 –º–∏–Ω—É—Ç`:
   - `revenue_by_vendor_last_15m`
   - `avg_fare_by_route_last_15m`
   - –∏ –¥—Ä—É–≥–∏–µ
4. **BI-–¥–∞—à–±–æ—Ä–¥—ã** ‚Äî Superset —Å—Ç—Ä–æ–∏—Ç –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –ø—Ä—è–º–æ –Ω–∞ —ç—Ç–∏—Ö live-–ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏—è—Ö.

üìå –≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç –≤–∏–¥–µ—Ç—å –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è –¥–∞–Ω–Ω—ã—Ö –ø–æ—á—Ç–∏ –≤ —Ä–µ–∞–ª—å–Ω–æ–º –≤—Ä–µ–º–µ–Ω–∏ (–∫–∞–∂–¥—ã–µ 1‚Äì2 —Å–µ–∫—É–Ω–¥—ã).

## üñºÔ∏è –ü—Ä–∏–º–µ—Ä –¥–∞—à–±–æ—Ä–¥–æ–≤
![–°—Ç–∏–º–∏–Ω–≥ –¥–∞–Ω–Ω—ã—Ö](img/streaming_data.gif)
![–î–∞—à–±–æ—Ä–¥ "–¢—è–∂–µ–ª–∞—è" –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç–∞–∫—Å–∏ –≤ Clickhouse"–¢—è–∂–µ–ª–∞—è" –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç–∞–∫—Å–∏ –≤ Clickhouse](img/heavy_dashboard.png)
![–î–∞—à–±–æ—Ä–¥ "–ñ–∏–≤–∞—è" –∞–Ω–∞–ª–∏—Ç–∏–∫–∞ —Ç–∞–∫—Å–∏ –≤ Clickhouse](img/streaming_update_dashboard.gif)


## üìé –ê–≤—Ç–æ—Ä
–Ø :) ‚Äî Fullstack-—Ä–∞–∑—Ä–∞–±–æ—Ç—á–∏–∫
